!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):((e=e||self).flowplayer=e.flowplayer||{},e.flowplayer.gemius=n())}(this,(function(){"use strict";function e(e,n,r){for(var a=function(e){return Array.isArray(e)?e.slice(0):e.split(".")}(n);a.length;){if(null==e)return r;var o=a.shift();if("string"!=typeof o)return r;e=e[o]}return null==e?r:e}var n=["playerID","gemiusID"],r=["programID","additionalParameters.programName","additionalParameters.programType","additionalParameters.programDuration","additionalParameters.typology"],a=["adName","adDuration","adType","campaignClassification","quality","resolution","volume"],o=!1;function t(n,r){var a=[];return r.forEach((function(r){void 0===e(n,r)&&a.push(r)})),a.length&&console.warn("Missing Gemius configuration: ",a.join(", ")),0===a.length}function i(e){return e<.5||isNaN(e)?0:e}return function(e,n){if("object"==typeof exports&&"undefined"!=typeof module)return n;"flowplayer"in e||(e.flowplayer={extensions:[]});var r=e.flowplayer;return"function"==typeof r?(r(n),n):(Array.isArray(r.extensions)||(r.extensions=[]),~r.extensions.indexOf(n)||r.extensions.push(n),n)}(window,(function(u,s,d){if("function"!=typeof GemiusPlayer)return console.warn("Gemius SDK needs to be loaded prior loading gemius plugin");var l,p=flowplayer.util.extend,f=e(u,"gemius.playerID"),m=e(u,"gemius.gemiusID"),c=e(u,"gemius.additionalParameters",{});if(t(e(u,"gemius",{}),n)){var y=new GemiusPlayer(f,m,c);y.setVideoObject(d),d.on("reap",(function(){D("stop"),y=void 0,window.removeEventListener("beforeunload",w)})),d.on("config",(function(n){l=e(n.data,"gemius",{})})),d.on("loadedmetadata",(function(){t(l,r)&&y.newProgram(l.programID,l.additionalParameters)})),window.addEventListener("beforeunload",w);var g={play:"play",pause:"pause",waiting:"buffer",seeking:"seek",ended:"complete"};if(d.on(Object.keys(g),(function(e){"ended"===e.type?o&&(o=!1,y.programEvent(l.programID,i(d.currentTime),g[e.type])):"play"===e.type?(o=!0,y.programEvent(l.programID,i(d.currentTime),g[e.type])):y.programEvent(l.programID,i(d.currentTime),g[e.type])})),d.ads){var v=flowplayer.AdEvents;d.ads.on(v.AD_STARTED,(function(e){var n;y.newAd(e.vast_ad_id,(n=p(p({},c),function(e){return{adDuration:e.ad.duration,adType:e.ad_type,resolution:e.ad.width+"x"+e.ad.height,volume:e.volume}}(e)),a.reduce((function(e,r){return n&&n.hasOwnProperty(r)&&(e[r]=n[r]),e}),{}))),y.adEvent(l.programID,e.vast_ad_id,i(d.currentTime),"play",{autoPlay:e.autoPlay,volume:e.volume})})),[v.AD_PAUSED,v.AD_COMPLETED].forEach((function(e){var n;switch(e){case v.AD_PAUSED:n="pause";break;case v.AD_COMPLETED:n="complete"}d.ads.on(e,(function(e){y.adEvent(l.programID,e.vast_ad_id,i(d.currentTime),n)}))}))}}function D(e){(d.ads&&d.ads.adPlaying()?y.adEvent:y.programEvent).call(y,l.programID,i(d.currentTime),e)}function w(){D("close")}}))}));

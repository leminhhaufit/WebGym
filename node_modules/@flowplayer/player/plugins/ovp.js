!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t=t||self).flowplayer=t.flowplayer||{},t.flowplayer.ovp=e())}(this,(function(){"use strict";var t=function(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)},e=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.reduce((function(n,r){return t(r)?(Object.keys(r).forEach((function(o){if(t(n[o])&&t(r[o]))return n[o]=e(n[o],r[o]);n[o]=r[o]})),n):n}),{})},n=[].slice;function r(){}function o(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];for(var o in e)t[o]=e[o];return t}function a(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.slice(1).reduce((function(t,e){return o(t,e)}),t[0]||{})}function i(t){return Array.isArray(t)?t.slice(0):t.split(".")}function u(t,e,n){for(var r=i(e);r.length;){if(null==t)return n;var o=r.shift();if("string"!=typeof o)return n;t=t[o]}return null==t?n:t}function c(t,e,n){var r=(e=i(e)).pop(),o=u(t,e);return o&&r&&(o[r]=n),t}function f(t){var e="number"==typeof t?t:parseInt(t,10);return(e>9?"":"0")+e}function s(t){return"function"==typeof t}function l(){throw new Error("Function was expected as Argument[0]")}var p=[].slice;function d(t){if(!(this instanceof d))return new d(t);var e=this;return e.data=t,e.tap=function(){var t=p.call(arguments),n=t.shift();return n==d.lift?e.data:s(n)?(n.apply(e,[e.data].concat(t)),e):void l()},e.into=e.fmap=function(){var t=p.call(arguments),n=t.shift();return n==d.lift?e.data:s(n)?d(n.apply(e,[e.data].concat(t))):void l()},e.unwrap=function(){return e.data},e}d.of=d,d.lift=function(t){return t instanceof d?t.data:t},d._apply=d.apply=function(t,e){if(0==e.length)return t();if(1==e.length)return t(e[0]);if(2==e.length)return t(e[0],e[1]);if(3==e.length)return t(e[0],e[1],e[2]);if(4==e.length)return t(e[0],e[1],e[2],e[3]);if(5==e.length)return t(e[0],e[1],e[2],e[3],e[4]);throw new Error("Pipe._apply() does not support arity > 5")},d.maybe=function(t,e,n){return t?d._apply(e,[t].concat(p.call(arguments,2,arguments.length))):t},d.curry=function(t,e,n){return(e=e||[]).length>t.length-1?t.apply(n,e):function(){var r=e.concat(p.call(arguments));return d.curry(t,r,n)}};var m=[].slice,v=Array.isArray;function y(t){return t&&"object"==typeof t&&"[object RegExp]"!==Object.prototype.toString.call(t)&&"[object Date]"!==Object.prototype.toString.call(t)}function _(t,e){return t.length===t.filter(e).length}function h(){return _(m.call(arguments),v)}function g(t,e){for(var n in t)e(n,t[n])}function w(t){return y(t)?v(t)?t.map(w):E({},t):t}function b(t,e){var n={};return g(t,(function(t,e){n[t]=w(e)})),function(t,e){return g(e,(function(e,n){if(void 0===t[e])return t[e]=w(n);t[e]=E(t[e],n)})),t}(n,e)}function E(t,e){return h(t,e)?function(t){return w(t)}(t):!1===t?t:!0===t&&!1!==e||!y(t)&&y(e)?e:void 0===t||y(t)?y(t)&&!y(e)?t:function(){return _(m.call(arguments),y)}(t,e)?b(t,e):void 0:t}function O(){return[].reduce.call(arguments,(function(t,e){return E(t,e)}),h.apply(null,arguments)?[]:{})}function j(){return O.apply(null,m.call(arguments).reverse())}function A(t,e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onreadystatechange=function(){try{var t=n.status;if(n.readyState<4)return;if(200!=t&&n.readyState>3&&"function"==typeof e.err){var r={status:t};try{o(r,JSON.parse(n.responseText))}catch(r){}return e.err(r)}e.ok(JSON.parse(n.responseText))}catch(r){console.error(r),e.err(r)}},n.send()}function C(){var t=[].join.call(arguments,"/");return"/"!==t[0]&&(t="/"+t),(flowplayer.OVP_API||"https://ljsp.lwcdn.com")+"/web/public/native/config"+t}function x(t){return~t.indexOf("/")?t:"/media/"+t}var S={404:"media not found",402:"invalid subscription",400:"bad request",415:"unsupported media type"};function T(t,e){var n=a({},t);return e.forEach((function(t){delete n[t]})),n}var N={media_id:"id",media_duration:"duration",media_name:"title",media_tags:"tags",category:"category_name",ad_keywords:"ad_keywords"};var L=["src","metadata","title","description","duration","poster"];function P(t){var e=u(t,"ima.ads");return Array.isArray(e)&&c(t,"ima.ads",e.map((function(e){return"number"==typeof e.percentage&&(e.time=e.percentage*t.duration),e}))),t}function k(t,e){e="object"==typeof e?e:{};var n={title:u(t,"metadata.title",null),description:u(t,"metadata.description",null)};return j({ima:{parameters:function(t,e,n){for(var r in n=n||{},t)n[r]=u(e||{},t[r]);return n}(N,u(t,"metadata",{}))}},n,t,T(e,L),T(e.embed||{},["src"]))}var I=/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/;function q(t){return"object"==typeof t&&"ovp/base64"==t.type}function R(t,e,n){return function(t,e){return!(~t.indexOf(".")||!I.test(t))&&(e.type="video/ovp",!0)}(t,e)||q(e)}function M(t){try{return D(decodeURIComponent(atob(t).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(t){return{err:t.message}}}function D(t){return null===t?{}:JSON.parse(t)}var V=Object.freeze({__proto__:null,base64:M,json:D});function U(t){var e=t.split(/[^0-9]/);return Date.UTC(e[0],e[1]-1,e[2],e[3],e[4],e[5])}var H=Object.freeze({__proto__:null,OVP_ERROR:"ovp:error",OVP_MEDIA_REQUEST_START:"ovp:request:start",OVP_MEDIA_REQUEST_COMPLETE:"ovp:request:media:complete",OVP_PLAYLIST_REQUEST_COMPLETE:"ovp:request:playlist:complete",LIVE_COUNTDOWN_TICK:"ovp:live:countdown:tick",LIVE_COUNTDOWN_START:"ovp:live:countdown:start",LIVE_COUNTDOWN_COMPLETE:"ovp:live:countdown:complete"});function W(t,e){if(q(e))return F(t,e);d(e).fmap(u,"src").fmap(x).fmap(C).fmap(A,{ok:d.curry(J,[t]),err:d.curry(z,[t])})}function F(t,e){d(e).fmap(u,"src").fmap(d.maybe,M).fmap(d.maybe,d.curry(J,[t]))}function J(t,e){if(u(e,"playlist"))return B(t,e);if(u(e,"live"))return G(t,e);if(u(e,"src"))return Q(t,e);throw new Error("Status[200] >> unhandled case\n"+JSON.stringify(e,null,2))}function z(t,e){return e.message?t.emit("ovp:error",e):e.status?t.emit("ovp:error",new Error(S[e.status])):t.emit("ovp:error",e)}function Q(t,e){t.emit("ovp:request:media:complete",d.of(e).fmap(k,t.opts).fmap(P).fmap(d.lift))}function B(t,e){if("function"!=typeof flowplayer.playlist)return console.warn("OVP responded with Playlist media but the playlist plugin does not exist"),z(t,{status:415});var n,r,o,i;t.emit("ovp:request:playlist:complete",(n=t.opts,r=e,o=a({},n),a(i=j({},r,u(n,"playlist",{})),{playlist:u(i,"playlist",[]).map((function(t){return k(t,o)}))})))}function G(t,e){var n=u(e,"metadata.live_start_time",u(e,"metadata.starttime"));c(e,"live_start_time",d.of(n).fmap(U).fmap(d.lift)),t.emit("ovp:live:countdown:start",d.of(e).fmap(k,t.opts).fmap(P).fmap(d.lift))}var K={};function X(t,e){if("object"==typeof K[e])return console.debug("using Cache(%s)",e),Y(t,e,K[e]);d(e).fmap(C).fmap(A,{ok:d.curry(Y,[t,e]),err:console.error})}function Y(t,e,n){"object"!=typeof K[e]&&(K[e]=n);var r=u(t,"opts",{}),o=u(r,"metadata",{});c(o,"player_id",e),["title","description"].forEach((function(t){!0===n[t]&&"string"==typeof r[t]&&c(n,t,u(r,t))})),c(r,"metadata",o);var i=a(r,n);t.setOpts(i),n.autoplay&&t.togglePlay(!0)}var Z=Object.freeze({__proto__:null,fetch_unknown_media:W,handle_base64:F,handle_200:J,handle_err:z,handle_single_media:Q,handle_playlist:B,handle_live:G,fetch_player_id:X,handle_player_only:Y}),$=void 0;function tt(t,e,n){et()||d.of("recommendation").fmap(C,e,n).fmap(A,{err:nt,ok:d.curry(rt,[t])})}function et(){return $}function nt(t){$=!0,console.error("Failed to load recommendations: %j",t)}function rt(t,e){var n=e.playlist;c(t,"opts.recommendations",n),u(n,"length",0)&&t.emit("recommendationsready",{playlist:n.map((function(t){return{poster:t.poster,src:t.src,title:u(t,"metadata.title"),metadata:t.metadata||{}}}))})}var ot=!!function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}catch(t){}return t}()&&{passive:!0},at=["touchstart","touchmove"];function it(t){return t.emit=function(e,n,r){r=r||{};var a=function(t){var e=document.createEvent("Event");return e.initEvent(t,!1,!0),e}(e);return n&&o(a,{data:n||{}}),t.dispatchEvent(a),!1===r.return_self?a:t},t.on=function(e,n){return"string"==typeof e&&(e=e.split(" ")),e.forEach((function(e){return function(t){return~at.indexOf(t)}(e)?t.addEventListener(e,n,ot):t.addEventListener(e,n)})),t},t.off=function(e,n){return t.removeEventListener(e,n),t},t.one=t.once=function(e,n){return t.on(e,(function r(o){t.off(e,r),n(o)}))},t}var ut=Array.isArray,ct="undefined"!=typeof window&&it(window),ft="undefined"!=typeof document&&it(document),st=["span","a","em","p","i"],lt=st.concat(["div","strong","video","img","ol","ul","li","script"]);function pt(t,e,n){var r=mt(document.createElement(t));if(ut(e)&&(n=e,e=!1),ut(n)||(n=[n]),r.append(n.filter((function(t){return t}))),"object"!=typeof e)return r;for(var o in e)o in r?r[o]=e[o]:r.setAttribute(o,e[o]);return r}function dt(t){var e=t.tagName;t.__flowplayer__=1,t.find=function(e){var n=t.querySelector(e);return n?mt(n):n},t.html=function(e){return t.innerHTML=e,t},t.empty=function(){return t.innerHTML="",t},t.offset=function(){var e={top:0,left:0},n=t;do{e.left+=n.offsetLeft||0,e.top+=n.offsetTop||0}while(n=n.offsetParent);return e},t.innerWidth=function(){var e=getComputedStyle(t);return t.clientWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)};var r=t.insert=function(e,n){return ut(n)?n.map((function(n){return t.insert(e,n)}))[0]:mt(n="string"==typeof n?t.insertAdjacentHTML(e,n):t.insertAdjacentElement?t.insertAdjacentElement(e,n):t.appendChild(n))};return t.append=r.bind(t,"beforeend"),t.prepend=r.bind(t,"afterbegin"),t.css=function(e,n){if("object"==typeof e){for(var r in e)t.css(r,e[r]);return t}return void 0===n?getComputedStyle(t)[e]:(1*n&&(n+="px"),t.style[e]=n,t)},t.show=function(){return t.css({display:~st.indexOf(e)?"inline":"block"})},t.hide=function(){return t.css({display:"none"})},t.remove=function(){var e=t.parentNode;e&&e.removeChild(t)},t.attr=function(e,n){return null==n?t.getAttribute(e):(t.setAttribute(e,n),t)},t.txt=function(e){return t.textContent=e,t},t.fp=function(e){return t.addClass("fp-"+e)},t.addClass=function(e){return e.split(" ").forEach((function(e){t.hasClass(e)||(t.className+=(t.className?" ":"")+e)})),t},t.removeClass=function(e){e=e.split(" ");var n=t.className.split(" ");return t.className=n.filter((function(t){return!~e.indexOf(t)})).join(" "),t},t.toggleClass=function(e,n){return void 0===n&&(n=!t.hasClass(e)),n?t.addClass(e):t.removeClass(e)},t.findAll=function(e){return r=t.querySelectorAll(e),n.call(r);var r},t.hasClass=function(e){return~t.className.split(" ").indexOf(e)},t}function mt(t){return void 0===t||function(t){return t&&t.__flowplayer__}(t)?t:dt(it(t))}function vt(t,e){if("string"==typeof t&&"<"==t[0])return pt(t.slice(1,-1),e);if("string"!=typeof t)return mt(t);var n=e instanceof HTMLElement&&e.querySelector(".fp-"+t)||document.querySelector(t);return n?mt(n):void 0}function yt(t,e,n){if(!ht(t))return n.emit("ovp:request:media:complete",t);var o=e.append(vt.div({class:"fp-livecountdown"})),a=o.append(vt.div({class:"fp-inner"}));a.append(vt.p({},n._t("ovp.starting_in")));var i=a.append(vt.p({class:"fp-countdown"}));function c(t){var r=u(t,"data.remaining",-1);if(r<0||isNaN(r))return n.emit("ovp:live:countdown:complete");e.addClass("is-livecountdown"),i.txt(function(t){var e=function(t){"number"!=typeof t&&(t=parseInt(t,10)),t=Math.round(t);var e=Math.floor(t/86400);t-=86400*e;var n=Math.floor(t/3600);t-=3600*n;var r=Math.floor(t/60);return{days:e,hours:n,minutes:r,seconds:t-=60*r}}(t),n="";e.days&&(n+=e.days+":");return n+f(e.hours)+":"+f(e.minutes)+":"+f(e.seconds)}(r+1)),n.hasState("is-starting")||n.setState("is-starting",!0)}n.on("ovp:live:countdown:tick",c),n.one("ovp:live:countdown:complete",(function(){o.remove(),e.removeClass("is-livecountdown"),n.off("ovp:live:countdown:tick",c),n.emit("ovp:request:media:complete",t)})),function(t,e){var n,o;function a(){clearInterval(n),clearInterval(o)}function i(){return t=e.live_start_time,n=u(e,"server_time_offset",0),r=Date.now()-n,Math.floor((t-r)/1e3);var t,n,r}function c(){var e=i();if(t.emit("ovp:live:countdown:tick",{remaining:e}),e<0||0===t.reaper)return a()}function f(){var n,o;if(0===i()||0===t.reaper)return a();n=e,o={err:console.error,ok:r},A((flowplayer.OVP_API||"https://ljsp.lwcdn.com")+"/web/public/countdown/time.json",{err:o.err,ok:function(t){var e=Date.now()-t.millisUtc;o.ok(E(n,{server_time_offset:e}))}})}c()&&f(),n=setInterval(c,250),o=setInterval(f,1e4)}(n,t)}function _t(t,e,n){}function ht(t){return t&&t.live_start_time-Date.now()>0}vt.window=ct,vt.document=ft,vt.el=pt,lt.forEach((function(t){vt[t]=function(e,n){return"string"==typeof e&&(e={class:e}),pt(t,e,n)}}));function gt(t,e,n){var r="flowplayer-ovp-branding-"+e;if(!t.hasClass(r)){!function(t){if(-1==t.className.indexOf("flowplayer-ovp-branding-"))return;t.className=t.className.split(" ").filter((function(t){return-1==t.indexOf("flowplayer-ovp-branding-")})).join(" ")}(t);var o=function(t){if(document.getElementById(t))return!1;var e=document.createElement("style");return e.id=t,e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet}(r);o&&(!function(t,e,n,r){if("insertRule"in t)return t.insertRule(e+"{"+n+"}",r);if("addRule"in t)t.addRule(e,n,r)}(o,"."+r+" .fp-color","background-color: #"+n+";"),t.addClass(r))}}function wt(t,n,r,o){var i=a({},t),c=function(t){if(!i)return t;delete i.src;var n=e(t,i);return i=0,n};if(4==arguments.length&&"object"==typeof o)return"string"!=typeof t.player_id||0===o.src.indexOf(t.player_id)||q(o)||(o.src=[t.player_id,o.src].join("/")),W(r,o);r.on("ovp:error",(function(t){r.emit("error",t.data)})),r.on("ovp:request:start",(function(){r.setState("is-waiting",!0),t.recommendations&&(t.recommendations=1)})),r.on("ovp:request:media:complete",(function(t){if(0!=r.reaper&&"object"==typeof t.data&&!ht(t.data)){var e=c(t.data);r.setOpts(e),r.setAttrs(e),r.setSrc(e.src),e.autoplay&&r.togglePlay(!0,(function(){setTimeout(r.setState,0,"is-seamless",!1)}))}})),r.on("config",(function(e){var o=u(e,"data.brand_color"),a=u(e,"data.metadata.player_id");if(o&&a&&gt(n,a,o),!("string"==typeof t.src&&R(t.src,{})||t.src&&t.src.length&&"ovp/base64"===t.src[0].type))return"string"==typeof t.player_id&&u(t,"metadata.player_id")!==t.player_id?X(r,t.player_id):void 0})),r.on("ovp:request:playlist:complete",(function(t){if(0!=r.reaper&&"object"==typeof t.data){var e=c(t.data);flowplayer.playlist(n,e)}})),r.on("ovp:live:countdown:start",(function(e){if(0!=r.reaper&&"object"==typeof e.data){var o=c(e.data);r.setOpts(o),r.setAttrs(o),r.render("live/countdown",[t,n,r])}})),r.on("timeupdate",(function(){t.live||t.recommendations&&u(t,"metadata.media_id")&&(Array.isArray(t.recommendations)||r.currentTime/r.duration<.8||et()||tt(r,u(t,"metadata.media_id"),u(t,"metadata.player_id")))}))}return wt.onumd=function(t){t.components.put("live/countdown",{onrender:yt,onremove:_t})},wt.wants=R,function(t,e){if("object"==typeof exports&&"undefined"!=typeof module)return e;"flowplayer"in t||(t.flowplayer={extensions:[]});var n=t.flowplayer;"function"==typeof n?n(e):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(e)||n.extensions.push(e))}("undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o(wt,{events:H,Decode:V,Loader:Z})),wt}));

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e=e||self).flowplayer=e.flowplayer||{},e.flowplayer.media_session=t())}(this,(function(){"use strict";function e(e,t,n){for(var i=function(e){return Array.isArray(e)?e.slice(0):e.split(".")}(t);i.length;){if(null==e)return n;var a=i.shift();if("string"!=typeof a)return n;e=e[a]}return null==e?n:e}var t=!!function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassive",null,t),window.removeEventListener("testPassive",null,t)}catch(e){}return e}()&&{passive:!0},n=["touchstart","touchmove"];function i(e){return e.emit=function(t,n,i){i=i||{};var a=function(e){var t=document.createEvent("Event");return t.initEvent(e,!1,!0),t}(t);return n&&function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];for(var a in t)e[a]=t[a]}(a,{data:n||{}}),e.dispatchEvent(a),!1===i.return_self?a:e},e.on=function(i,a){return"string"==typeof i&&(i=i.split(" ")),i.forEach((function(i){return function(e){return~n.indexOf(e)}(i)?e.addEventListener(i,a,t):e.addEventListener(i,a)})),e},e.off=function(t,n){return e.removeEventListener(t,n),e},e.one=e.once=function(t,n){return e.on(t,(function i(a){e.off(t,i),n(a)}))},e}"undefined"!=typeof window&&i(window),"undefined"!=typeof document&&i(document);function a(e){if(e.opts.live_seekable_range)return e.opts.live_seekable_range;if(!e.seekable.length)return{head:0,tail:0};var t=e.opts.live_dvr_window||0,n=e.seekable.end(e.seekable.length-1);return{head:n,tail:Math.max(e.seekable.start(0),n-t)}}function r(e,t,n){try{if(!t.hasState("is-live-seeked"))return;t.dvr_offset=0;var i=function(e){return e.opts.live_now||function(e){return a(e).head}(e)-function(e){return e.opts.live_rebuffer_budget||10}(e)}(t);t.currentTime=i,t.setState("is-live-seeked",!1),n.progress.css("width",0)}catch(e){console.warn("failed to seek to now: %j",e)}}var o=null;function s(e,t,n){if(!t||!e.disabled){var i,a,r=e.currentTime,o=e.duration,s=0;n<1&&(s=n*o),n>=1&&(s=n),1==t&&(s=Math.abs(s)),0==t&&s>0&&(s*=-1),e.currentTime=(i=r+s,a=o,Math.max(Math.min(a,i),0))}}function u(e,t,n){if(!(0==e.opts.seekable||e.disabled&&t)){if(n=n||.15,function(e){e.setState("is-kb-active",!0),clearTimeout(o),o=setTimeout((function(){e.setState("is-kb-active",!1)}),2500)}(e),e.opts.live)return function(e,t,n,i){var o=e.root.controls,s=a(e),u=s.head-s.tail,f=function(e,t,n,i,a){if(void 0!==a)return 10*a;var r=100*(n?1:-1);return r*=i<1?i:i/t,(e.dvr_offset||100)+r}(e,u,t,n,i);if(f>=100)return r(0,e,o);f=Math.max(.1,f),e.dvr_offset=f;var d=100-e.dvr_offset;o.progress.css("width",d+"%"),e.setState("is-live-seeked",d>0);var l=u*(1-e.dvr_offset/100),c=s.head-l;e.currentTime=c}(e,t,n);s(e,t,n)}}var f,d,l="playlist:next",c="pause",v="playing",p="seeked",m=(d={val:f},function(e){return void 0!==e&&(d.val=e),d.val});function y(e){h(e.data)}function h(t){var n=e(t,"media_session",{});if("title"in n||(n.title=e(t,"title")),!("artwork"in n)){var i="poster"in t?e(t,"poster"):"";n.artwork=[{src:i,sizes:"512x512"},{src:i,sizes:"256x256"}]}navigator.mediaSession.metadata=new MediaMetadata(n)}function g(){if("setPositionState"in navigator.mediaSession){var e=m();navigator.mediaSession.setPositionState({duration:Math.round(e.duration||0),playbackRate:e.hasState("is-playing")?e.playbackRate:.001,position:Math.round(e.currentTime)}),navigator.mediaSession.playbackState=e.hasState("is-playing")?"playing":"paused"}}return function(e,t){if("object"==typeof exports&&"undefined"!=typeof module)return t;"flowplayer"in e||(e.flowplayer={extensions:[]});var n=e.flowplayer;return"function"==typeof n?(n(t),t):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(t)||n.extensions.push(t),t)}(window,(function(t,n,i){"mediaSession"in navigator&&i.on(["loadstart",v,"fullscreenenter"],(function(){var t=m();i!==t&&(t&&(["ratechange",p,v,c].forEach((function(e){t.off(e,g)})),t.off(l,y),t=null),m(i),h(i.opts),function(){var t=m();navigator.mediaSession.setActionHandler("play",(function(){t.togglePlay()})),navigator.mediaSession.setActionHandler("pause",(function(){t.togglePlay()})),t.playlist&&(navigator.mediaSession.setActionHandler("nexttrack",(function(){t.playlist.next()})),navigator.mediaSession.setActionHandler("previoustrack",(function(){t.playlist.prev()})));!function(t){if(!e(t,"opts.seekable",!0)||t.hasState("no-timeline"))return;var n=e(t,"opts.media_session.seek_step",.15);t.disabled||navigator.mediaSession.setActionHandler("seekforward",(function(){u(t,!0,n)}));navigator.mediaSession.setActionHandler("seekbackward",(function(){u(t,!1,n)}));try{navigator.mediaSession.setActionHandler("seekto",(function(e){e.seekTime>t.currentTime&&t.disabled?g():e.seekTime<t.duration&&(t.currentTime=e.seekTime)}))}catch(e){}}(t)}(),g(),i.on(["ratechange",p,v,c],g),i.on(l,y))}))}))}));

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e=e||self).flowplayer=e.flowplayer||{},e.flowplayer.keyboard=t())}(this,(function(){"use strict";var e=[].slice;function t(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];for(var i in t)e[i]=t[i];return e}function n(e,t,n){for(var r=function(e){return Array.isArray(e)?e.slice(0):e.split(".")}(t);r.length;){if(null==e)return n;var i=r.shift();if("string"!=typeof i)return n;e=e[i]}return null==e?n:e}var r=!!function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassive",null,t),window.removeEventListener("testPassive",null,t)}catch(e){}return e}()&&{passive:!0},i=["touchstart","touchmove"];function o(e){return e.emit=function(n,r,i){i=i||{};var o=function(e){var t=document.createEvent("Event");return t.initEvent(e,!1,!0),t}(n);return r&&t(o,{data:r||{}}),e.dispatchEvent(o),!1===i.return_self?o:e},e.on=function(t,n){return"string"==typeof t&&(t=t.split(" ")),t.forEach((function(t){return function(e){return~i.indexOf(e)}(t)?e.addEventListener(t,n,r):e.addEventListener(t,n)})),e},e.off=function(t,n){return e.removeEventListener(t,n),e},e.one=e.once=function(t,n){return e.on(t,(function r(i){e.off(t,r),n(i)}))},e}var a=Array.isArray,u="undefined"!=typeof window&&o(window),s="undefined"!=typeof document&&o(document),l=["span","a","em","p","i"],f=l.concat(["div","strong","video","img","ol","ul","li","script"]);function c(e,t,n){var r=p(document.createElement(e));if(a(t)&&(n=t,t=!1),a(n)||(n=[n]),r.append(n.filter((function(e){return e}))),"object"!=typeof t)return r;for(var i in t)i in r?r[i]=t[i]:r.setAttribute(i,t[i]);return r}function d(t){var n=t.tagName;t.__flowplayer__=1,t.find=function(e){var n=t.querySelector(e);return n?p(n):n},t.html=function(e){return t.innerHTML=e,t},t.empty=function(){return t.innerHTML="",t},t.offset=function(){var e={top:0,left:0},n=t;do{e.left+=n.offsetLeft||0,e.top+=n.offsetTop||0}while(n=n.offsetParent);return e},t.innerWidth=function(){var e=getComputedStyle(t);return t.clientWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)};var r=t.insert=function(e,n){return a(n)?n.map((function(n){return t.insert(e,n)}))[0]:p(n="string"==typeof n?t.insertAdjacentHTML(e,n):t.insertAdjacentElement?t.insertAdjacentElement(e,n):t.appendChild(n))};return t.append=r.bind(t,"beforeend"),t.prepend=r.bind(t,"afterbegin"),t.css=function(e,n){if("object"==typeof e){for(var r in e)t.css(r,e[r]);return t}return void 0===n?getComputedStyle(t)[e]:(1*n&&(n+="px"),t.style[e]=n,t)},t.show=function(){return t.css({display:~l.indexOf(n)?"inline":"block"})},t.hide=function(){return t.css({display:"none"})},t.remove=function(){var e=t.parentNode;e&&e.removeChild(t)},t.attr=function(e,n){return null==n?t.getAttribute(e):(t.setAttribute(e,n),t)},t.txt=function(e){return t.textContent=e,t},t.fp=function(e){return t.addClass("fp-"+e)},t.addClass=function(e){return e.split(" ").forEach((function(e){t.hasClass(e)||(t.className+=(t.className?" ":"")+e)})),t},t.removeClass=function(e){e=e.split(" ");var n=t.className.split(" ");return t.className=n.filter((function(t){return!~e.indexOf(t)})).join(" "),t},t.toggleClass=function(e,n){return void 0===n&&(n=!t.hasClass(e)),n?t.addClass(e):t.removeClass(e)},t.findAll=function(n){return r=t.querySelectorAll(n),e.call(r);var r},t.hasClass=function(e){return~t.className.split(" ").indexOf(e)},t}function p(e){return void 0===e||function(e){return e&&e.__flowplayer__}(e)?e:d(o(e))}function v(e,t){if("string"==typeof e&&"<"==e[0])return c(e.slice(1,-1),t);if("string"!=typeof e)return p(e);var n=t instanceof HTMLElement&&t.querySelector(".fp-"+e)||document.querySelector(e);return n?p(n):void 0}function m(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function _(e){var t,n,r=m("svg");return r.setAttribute("viewBox",e.coords),e.name&&r.setAttribute("class",e.name),e.title&&r.setAttribute("title",e.title),e.title&&r.setAttribute("aria-label",e.title),r.setAttribute("tabindex","0"),r.setAttribute("focusable","true"),r.appendChild((t=e.link,(n=m("use")).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t),n)),v(r)}v.window=u,v.document=s,v.el=c,f.forEach((function(e){v[e]=function(t,n){return"string"==typeof t&&(t={class:t}),c(e,t,n)}}));var h={TOGGLE_OPEN:"menu:toggle:open",RENDER:"menu:render",PUSH:"menu:push"},E={ON:"fp-on",INVIS:"fp-invis"};function g(e,t){var n=window.__flowplayer_active_menu;if(n&&n.root&&n.root!==t&&n.root.toggleClass("has-menu-opened",!1),!e||!t)return n.menu=0,void(n.root=0);n.menu=e,n.root=t,n.root.toggleClass("has-menu-opened",!0)}if(!window.__flowplayer_active_menu){window.__flowplayer_active_menu={menu:0,root:0};document.addEventListener("click",(function(e){if(window.__flowplayer_active_menu){var t=window.__flowplayer_active_menu.menu,n=window.__flowplayer_active_menu.root;if(t&&n)if(document.contains(t)){if(t.hasClass(E.ON)){var r=t.parentElement;t.contains(e.target)||r.contains(e.target)||n.emit(h.TOGGLE_OPEN,{menu:t,open:!1})}}else g(null)}}))}function y(e,n,r){var i=r.id||"menu-"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5);return r=r||{},e.attr("role","button").attr("aria-haspopup","true").attr("aria-expanded","false").attr("aria-controls",i).attr("aria-label",r.title),r.options=r.options||[],r.id=i,y._interface(e,n,function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.slice(1).reduce((function(e,n){return t(e,n)}),e[0]||{})}({},r))}y.title=function(e){return v("<h3>").txt(e)},y.close=function(e){return v.span("fp-close").on("click",e).html("&times;")},y.option=function(e,t){var n=this,r=v("<li>").attr("tabindex","0").attr("role","menuitem"),i=n._attrs;e.icon&&r.append(_(e.icon)),r.append(v("<span>").txt(e.text)),r.on("click",(function(r){i.multi||n.options().forEach(y.off),n.activate(t),"function"==typeof e.onclick&&e.onclick(r,e,t,n)})),r.idx=t,n.append(r)},y._interface=function(e,t,r){e.addClass("fp-menu-container");var i=v("<ul>").attr("id",r.id).addClass("fp-menu").attr("role","menu");return r.icons&&i.addClass("fp-icons"),i._attrs=r,e.on("click",(function(e){setTimeout((function(){if(!e.defaultPrevented)return i.hasClass(E.ON)?t.emit(h.TOGGLE_OPEN,{menu:i,open:!1}):void t.emit(h.TOGGLE_OPEN,{menu:i,open:!0})}),0)})),t.on(h.TOGGLE_OPEN,(function(r){if(n(r,"data.menu")!==i)return i.toggleClass(E.ON,!1),e.attr("aria-expanded","false");var o=n(r,"data.open",!1);if(i.toggleClass(E.ON,o),o?g(i,t):g(null),e.attr("aria-expanded",o?"true":"false"),t.hasClass("is-accessibility"))if(o){var a=i.options()[0];a&&a.focus()}else e.focus()})),i.push=function(e){return i._attrs.options=n(i,"_attrs.options",[]),i._attrs.options.push(e),i.render()},i.select=function(e){return i.render(i.options.filter(e))},i.render=function(t){var n=i._attrs;return i.empty(),i.prepend(y.close()),n.title&&i.prepend(y.title(n.title)),n.options=t||n.options,n.options.forEach(y.option,i),e.toggleClass(E.INVIS,0==n.options.length),i._activate(),i},i.close=function(){i.hasClass(E.ON)&&t.emit(h.TOGGLE_OPEN,{menu:i,open:!1})},i._activate=function(){i.options().forEach((function(e){e.toggleClass(E.ON,e.idx===i.idx)}))},i.options=function(){return[].slice.call(i.querySelectorAll("li"))},i.activate=function(e,t){void 0===i.idx||i.idx!==e||t?i.idx=e:delete i.idx,i._activate()},i.deactivate=function(){i.activate(i.idx)},i.render(r.options),e.appendChild(i),i},y.on=function(e){return e.addClass(E.ON),e},y.off=function(e){return e.removeClass(E.ON),e},y.CONTAINER_CLASS="fp-menu",y.Events=h,y.States=E;var w={TAB:9,ENTER:13,ESCAPE:27,SPACE:32,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,F:70,H:72,J:74,K:75,L:76,M:77};function O(e){if(e.opts.live_seekable_range)return e.opts.live_seekable_range;if(!e.seekable.length)return{head:0,tail:0};var t=e.opts.live_dvr_window||0,n=e.seekable.end(e.seekable.length-1);return{head:n,tail:Math.max(e.seekable.start(0),n-t)}}function A(e,t,n){try{if(!t.hasState("is-live-seeked"))return;t.dvr_offset=0;var r=function(e){return e.opts.live_now||function(e){return O(e).head}(e)-function(e){return e.opts.live_rebuffer_budget||10}(e)}(t);t.currentTime=r,t.setState("is-live-seeked",!1),n.progress.css("width",0)}catch(e){console.warn("failed to seek to now: %j",e)}}var b=null;function R(e,t){return Math.max(Math.min(t,e),0)}function x(e,t,n,r){var i=e.root.controls,o=O(e),a=o.head-o.tail,u=function(e,t,n,r,i){if(void 0!==i)return 10*i;var o=100*(n?1:-1);return o*=r<1?r:r/t,(e.dvr_offset||100)+o}(e,a,t,n,r);if(u>=100)return A(0,e,i);u=Math.max(.1,u),e.dvr_offset=u;var s=100-e.dvr_offset;i.progress.css("width",s+"%"),e.setState("is-live-seeked",s>0);var l=a*(1-e.dvr_offset/100),f=o.head-l;e.currentTime=f}function C(e){e.setState("is-kb-active",!0),clearTimeout(b),b=setTimeout((function(){e.setState("is-kb-active",!1)}),2500)}function S(e,t,n){if(!(0==e.opts.seekable||e.disabled&&t)){if(n=n||.15,C(e),e.opts.live)return x(e,t,n);!function(e,t,n){if(!t||!e.disabled){var r=e.currentTime,i=e.duration,o=0;n<1&&(o=n*i),n>=1&&(o=n),1==t&&(o=Math.abs(o)),0==t&&o>0&&(o*=-1),e.currentTime=R(r+o,i)}}(e,t,n)}}var N,T,P=(T={val:N},function(e){return void 0!==e&&(T.val=e),T.val}),W=[w.ARROW_UP,w.ARROW_RIGHT,w.ARROW_LEFT,w.ARROW_DOWN],k=[w.SPACE,w.F,w.ESCAPE,w.M,w.ARROW_UP,w.ARROW_DOWN,w.ARROW_RIGHT,w.ARROW_LEFT,w.H,w.J,w.K,w.L];function L(e,t){e.volume=R(e.volume+t,1),C(e)}function G(e,t){return!(t.altKey||t.shiftKey||t.metaKey||t.ctrlKey)&&(!!(e&&e.in_viewport&&e.started)&&(!!e.root&&(function(e){var t=document.activeElement;for(;t;){if(t===e)return!0;t=t.parentElement}return!1}(e.root)||document.activeElement===document.body)))}function M(e){var t=e.which,r=P(),i=n(r,"opts.keyboard.seek_step",.15),o=document.activeElement;function a(){e.preventDefault(),e.stopPropagation()}if((t===w.SPACE||t===w.ENTER)&&o.hasAttribute("tabindex")&&D(o,".flowplayer"))return o.dispatchEvent(new MouseEvent("click",{bubbles:!0})),a();if(~W.indexOf(t)&&o.hasAttribute("aria-valuenow")){var u=~[w.ARROW_UP,w.ARROW_RIGHT].indexOf(t);if(o.matches(".fp-volume"))return L(r,u?.15:-.15),a();if(o.matches(".fp-timeline"))return S(r,u,i),a()}if((t===w.ARROW_DOWN||t===w.ARROW_UP||t===w.ESCAPE)&&D(o,".fp-menu"))return e.preventDefault(),t===w.ARROW_DOWN&&o.nextSibling&&o.nextSibling.focus(),t===w.ARROW_UP&&o.previousSibling&&o.previousSibling.focus(),void(t===w.ESCAPE&&r.root.emit(y.Events.TOGGLE_OPEN,{open:!1,menu:F(o,".fp-menu")}));if(t===w.TAB&&flowplayer.instances.forEach((function(e){e.setState("is-hovered",!0),e.setState("is-accessibility",!0)})),G(r,e)){var s=!r.hasState("no-timeline");if(t>47&&t<58&&s)return e.preventDefault(),function(e,t){if(0!=e.opts.seekable){var n=e.duration,r=t/10*n;if(C(e),e.opts.live)return x(e,null,null,t);r>e.currentTime&&e.disabled||n&&(e.currentTime=r)}}(r,t-48);switch(~k.indexOf(t)&&e.preventDefault(),t){case w.SPACE:return r.togglePlay();case w.F:return r.toggleFullScreen();case w.ESCAPE:return r.toggleFullScreen(!1);case w.M:return r.toggleMute();case w.ARROW_UP:case w.K:return L(r,.15);case w.ARROW_DOWN:case w.J:return L(r,-.15);case w.ARROW_RIGHT:case w.L:return s&&S(r,!0,i);case w.ARROW_LEFT:case w.H:return s&&S(r,!1,i)}}}function H(e,t,n){n.on(["loadstart","playing","fullscreenenter"],(function(){P(n)}))}function D(e,t){return!!F(e,t)}function F(e,t){return!!e.parentElement&&(e.parentElement.matches(t)?e.parentElement:D(e.parentElement,t))}return v.document.on("keydown",(function(e){setTimeout((function(){e.defaultPrevented||M(e)}),0)})),function(e,t){if("object"==typeof exports&&"undefined"!=typeof module)return t;"flowplayer"in e||(e.flowplayer={extensions:[]});var n=e.flowplayer;"function"==typeof n?n(t):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(t)||n.extensions.push(t))}(window,H),H}));

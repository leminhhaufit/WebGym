!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t=t||self).flowplayer=t.flowplayer||{},t.flowplayer.asel=e())}(this,(function(){"use strict";var t=[].slice;function e(){}function n(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];for(var i in e)t[i]=e[i];return t}function r(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.slice(1).reduce((function(t,e){return n(t,e)}),t[0]||{})}function i(t){return Array.isArray(t)?t.slice(0):t.split(".")}function o(t,e,n){for(var r=i(e);r.length;){if(null==t)return n;var o=r.shift();if("string"!=typeof o)return n;t=t[o]}return null==t?n:t}function a(t,e,n){var r=(e=i(e)).pop(),a=o(t,e);return a&&r&&(a[r]=n),t}var u=!!function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}catch(t){}return t}()&&{passive:!0},s=["touchstart","touchmove"];function c(t){return t.emit=function(e,r,i){i=i||{};var o=function(t){var e=document.createEvent("Event");return e.initEvent(t,!1,!0),e}(e);return r&&n(o,{data:r||{}}),t.dispatchEvent(o),!1===i.return_self?o:t},t.on=function(e,n){return"string"==typeof e&&(e=e.split(" ")),e.forEach((function(e){return function(t){return~s.indexOf(t)}(e)?t.addEventListener(e,n,u):t.addEventListener(e,n)})),t},t.off=function(e,n){return t.removeEventListener(e,n),t},t.one=t.once=function(e,n){return t.on(e,(function r(i){t.off(e,r),n(i)}))},t}var f=Array.isArray,l="undefined"!=typeof window&&c(window),d="undefined"!=typeof document&&c(document),p=["span","a","em","p","i"],v=p.concat(["div","strong","video","img","ol","ul","li","script"]);function m(t,e,n){var r=y(document.createElement(t));if(f(e)&&(n=e,e=!1),f(n)||(n=[n]),r.append(n.filter((function(t){return t}))),"object"!=typeof e)return r;for(var i in e)i in r?r[i]=e[i]:r.setAttribute(i,e[i]);return r}function g(e){var n=e.tagName;e.__flowplayer__=1,e.find=function(t){var n=e.querySelector(t);return n?y(n):n},e.html=function(t){return e.innerHTML=t,e},e.empty=function(){return e.innerHTML="",e},e.offset=function(){var t={top:0,left:0},n=e;do{t.left+=n.offsetLeft||0,t.top+=n.offsetTop||0}while(n=n.offsetParent);return t},e.innerWidth=function(){var t=getComputedStyle(e);return e.clientWidth-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)};var r=e.insert=function(t,n){return f(n)?n.map((function(n){return e.insert(t,n)}))[0]:y(n="string"==typeof n?e.insertAdjacentHTML(t,n):e.insertAdjacentElement?e.insertAdjacentElement(t,n):e.appendChild(n))};return e.append=r.bind(e,"beforeend"),e.prepend=r.bind(e,"afterbegin"),e.css=function(t,n){if("object"==typeof t){for(var r in t)e.css(r,t[r]);return e}return void 0===n?getComputedStyle(e)[t]:(1*n&&(n+="px"),e.style[t]=n,e)},e.show=function(){return e.css({display:~p.indexOf(n)?"inline":"block"})},e.hide=function(){return e.css({display:"none"})},e.remove=function(){var t=e.parentNode;t&&t.removeChild(e)},e.attr=function(t,n){return null==n?e.getAttribute(t):(e.setAttribute(t,n),e)},e.txt=function(t){return e.textContent=t,e},e.fp=function(t){return e.addClass("fp-"+t)},e.addClass=function(t){return t.split(" ").forEach((function(t){e.hasClass(t)||(e.className+=(e.className?" ":"")+t)})),e},e.removeClass=function(t){t=t.split(" ");var n=e.className.split(" ");return e.className=n.filter((function(e){return!~t.indexOf(e)})).join(" "),e},e.toggleClass=function(t,n){return void 0===n&&(n=!e.hasClass(t)),n?e.addClass(t):e.removeClass(t)},e.findAll=function(n){return r=e.querySelectorAll(n),t.call(r);var r},e.hasClass=function(t){return~e.className.split(" ").indexOf(t)},e}function y(t){return void 0===t||function(t){return t&&t.__flowplayer__}(t)?t:g(c(t))}function h(t,e){if("string"==typeof t&&"<"==t[0])return m(t.slice(1,-1),e);if("string"!=typeof t)return y(t);var n=e instanceof HTMLElement&&e.querySelector(".fp-"+t)||document.querySelector(t);return n?y(n):void 0}function w(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function _(t){var e,n,r=w("svg");return r.setAttribute("viewBox",t.coords),t.name&&r.setAttribute("class",t.name),t.title&&r.setAttribute("title",t.title),t.title&&r.setAttribute("aria-label",t.title),r.setAttribute("tabindex","0"),r.setAttribute("focusable","true"),r.appendChild((e=t.link,(n=w("use")).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e),n)),h(r)}h.window=l,h.document=d,h.el=m,v.forEach((function(t){h[t]=function(e,n){return"string"==typeof e&&(e={class:e}),m(t,e,n)}}));var x={TOGGLE_OPEN:"menu:toggle:open",RENDER:"menu:render",PUSH:"menu:push"},b={ON:"fp-on",INVIS:"fp-invis"};function E(t,e){var n=window.__flowplayer_active_menu;if(n&&n.root&&n.root!==e&&n.root.toggleClass("has-menu-opened",!1),!t||!e)return n.menu=0,void(n.root=0);n.menu=t,n.root=e,n.root.toggleClass("has-menu-opened",!0)}if(!window.__flowplayer_active_menu){window.__flowplayer_active_menu={menu:0,root:0};document.addEventListener("click",(function(t){if(window.__flowplayer_active_menu){var e=window.__flowplayer_active_menu.menu,n=window.__flowplayer_active_menu.root;if(e&&n)if(document.contains(e)){if(e.hasClass(b.ON)){var r=e.parentElement;e.contains(t.target)||r.contains(t.target)||n.emit(x.TOGGLE_OPEN,{menu:e,open:!1})}}else E(null)}}))}function C(t,e,n){var i=n.id||"menu-"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5);return n=n||{},t.attr("role","button").attr("aria-haspopup","true").attr("aria-expanded","false").attr("aria-controls",i).attr("aria-label",n.title),n.options=n.options||[],n.id=i,C._interface(t,e,r({},n))}C.title=function(t){return h("<h3>").txt(t)},C.close=function(t){return h.span("fp-close").on("click",t).html("&times;")},C.option=function(t,e){var n=this,r=h("<li>").attr("tabindex","0").attr("role","menuitem"),i=n._attrs;t.icon&&r.append(_(t.icon)),r.append(h("<span>").txt(t.text)),r.on("click",(function(r){i.multi||n.options().forEach(C.off),n.activate(e),"function"==typeof t.onclick&&t.onclick(r,t,e,n)})),r.idx=e,n.append(r)},C._interface=function(t,e,n){t.addClass("fp-menu-container");var r=h("<ul>").attr("id",n.id).addClass("fp-menu").attr("role","menu");return n.icons&&r.addClass("fp-icons"),r._attrs=n,t.on("click",(function(t){setTimeout((function(){if(!t.defaultPrevented)return r.hasClass(b.ON)?e.emit(x.TOGGLE_OPEN,{menu:r,open:!1}):void e.emit(x.TOGGLE_OPEN,{menu:r,open:!0})}),0)})),e.on(x.TOGGLE_OPEN,(function(n){if(o(n,"data.menu")!==r)return r.toggleClass(b.ON,!1),t.attr("aria-expanded","false");var i=o(n,"data.open",!1);if(r.toggleClass(b.ON,i),i?E(r,e):E(null),t.attr("aria-expanded",i?"true":"false"),e.hasClass("is-accessibility"))if(i){var a=r.options()[0];a&&a.focus()}else t.focus()})),r.push=function(t){return r._attrs.options=o(r,"_attrs.options",[]),r._attrs.options.push(t),r.render()},r.select=function(t){return r.render(r.options.filter(t))},r.render=function(e){var n=r._attrs;return r.empty(),r.prepend(C.close()),n.title&&r.prepend(C.title(n.title)),n.options=e||n.options,n.options.forEach(C.option,r),t.toggleClass(b.INVIS,0==n.options.length),r._activate(),r},r.close=function(){r.hasClass(b.ON)&&e.emit(x.TOGGLE_OPEN,{menu:r,open:!1})},r._activate=function(){r.options().forEach((function(t){t.toggleClass(b.ON,t.idx===r.idx)}))},r.options=function(){return[].slice.call(r.querySelectorAll("li"))},r.activate=function(t,e){void 0===r.idx||r.idx!==t||e?r.idx=t:delete r.idx,r._activate()},r.deactivate=function(){r.activate(r.idx)},r.render(n.options),t.appendChild(r),r},C.on=function(t){return t.addClass(b.ON),t},C.off=function(t){return t.removeClass(b.ON),t},C.CONTAINER_CLASS="fp-menu",C.Events=x,C.States=b;var O={SET:"audio:set",SWITCH:"audio:update",TRACKS:"audio:tracks"},k=new function(){function t(){this.getItem=this.removeItem=this.setItem=e}function n(e,n){var r=function(){try{return window.localStorage||new t}catch(e){return new t}}();return function(){try{return r[e].apply(r,arguments)}catch(t){return n}}}this.removeItem=n("removeItem"),this.getItem=n("getItem",null),this.setItem=n("setItem")},A=[].concat;function N(t,e,n,r,i){var o=i._attrs.options[r];t.emit(O.SET,o),o.autoselect&&k.setItem("@flowplayer/audio/track",o.lang)}function S(t){return t.toLowerCase()}function T(t,e){t=t.slice(0);var n={},r=k.getItem("@flowplayer/audio/track"),i=function(){try{return A.apply([],(navigator.languages||[navigator.language]).map((function(t){return~t.indexOf("-")?[t,t.split("-")[0]]:[t]}))).map((function(t){return t.toLowerCase()}))}catch(t){return[]}}(),a=-1;if("number"==typeof e)return e;for("string"==typeof e&&(e=e.toLowerCase(),~i.indexOf(e)&&i.splice(i.indexOf(e),1),i.unshift(S(e))),Array.isArray(e)&&(i=e.map(S));t.length;){++a;var u=t.shift();if(u.autoselect){if(r==u.lang)return console.debug("restoring lang from previous session: ",r),a;if(u.default&&(n.fallback=[a,u]),u.lang&&~i.indexOf(u.lang.toLowerCase())){var s=i.indexOf(u.lang);if(s<o(n,"by_lang.2",1/0)&&(n.by_lang=[a,u,s]),0===s)break}}}return o(n,"by_lang.0",o(n,"fallback.0",void 0))}function L(t){return Array.isArray(t)?t.join("."):t}function I(t,e){return e.length-t.length}function G(t){if(void 0!==t){if(t.reaper)return t.reaper;if(!(this instanceof G))return new G(t);var e=t.reaper=this;return e.tree=t,e.props=[],e.push=function(t){return e.props=e.props.concat(t),e},e.put=function(n,r){return e.push(n),a(t,n,r),r},e.run=function(n){(n=Array.isArray(n)?n:[]).push(e);for(var r=e.props.map(L).sort(I);r.length;){var i=r.shift(),u=o(t,i);u&&u.reaper&&!~n.indexOf(u.reaper)&&u.reaper.run(n),a(t,i,0)}for(var s in e)delete e[s];delete n[n.indexOf(e)],t.reaper=0},e}}function P(t,e,n){if(!1!==t.asel){var i=h.span("fp-asel fp-menu-container").txt(n._t("audio.button_txt").toUpperCase()).attr("tabindex","0"),a=C(i,e,{title:n._t("audio.menu_title"),options:[]}),u=n.reaper.put("asel",function(t,e){var n={tracks:[],events:O};return G(n),n.reaper.put("menu",e),n.set=function(r){return e.idx!==r&&e.activate(r,!0),t.emit(O.SET,n.tracks[r]),n},n.get=function(t){return t?n.track[t]:n.tracks[e.idx]},n}(n,a));n.on("mount",(function(){e.controls&&e.controls.append(i)})),n.on(O.TRACKS,(function(e){if(Array.isArray(e.data)){u.tracks=e.data.slice();var i=o(t,"asel.sort");"function"==typeof i&&u.tracks.sort(i),a.render(u.tracks.map((function(t){return r({},t,{text:t.name||t.label||t.lang,onclick:N.bind(0,n)})})));var s=u.tracks.filter((function(t){return t.enabled}))[0];s&&a.activate(u.tracks.indexOf(s),!0);var c=T(u.tracks,o(t,"asel.default_lang",!1));return void 0!==c?u.set(c):void 0}})),n.on(O.SWITCH,(function(t){var e=o(t,"data.id",-1),n=u.tracks.filter((function(t){return t.id===e}))[0];n&&a.activate(u.tracks.indexOf(n),!0)})),n.audioTracks&&(n.audioTracks.addEventListener("addtrack",(function(){if(!n.hls){var t=[].slice.call(n.audioTracks).map(j);n.emit(O.TRACKS,t)}})),n.on(O.SET,(function(t){n.hls||[].forEach.call(n.audioTracks,(function(e){e.enabled=t.data.id===e.id}))})))}}function j(t){return Object.assign.apply(null,[{}].concat(["id","kind","enabled","label","language"].map((function(e){var n={};return n[e]=t[e],n}))))}return P.events=O,function(t,e){if("object"==typeof exports&&"undefined"!=typeof module)return e;"flowplayer"in t||(t.flowplayer={extensions:[]});var n=t.flowplayer;"function"==typeof n?n(e):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(e)||n.extensions.push(e))}(window,P),P}));
